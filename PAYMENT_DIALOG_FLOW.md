# üìã –õ–æ–≥–∏–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ –æ–∫–Ω–∞ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /payment

## üéØ –ù–∞—á–∞–ª–æ –¥–∏–∞–ª–æ–≥–∞

### –ö–æ–º–∞–Ω–¥–∞: `/payment`

**Handler:** `payment_command()` –≤ `modules/payments/handlers.py`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç—É–ø–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`get_user_access_info`)
2. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–∑ `WELCOME_SALES`
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∞, –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ —Ç.–¥.)
4. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å 4 –∫–Ω–æ–ø–∫–∞–º–∏
5. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ `PaymentStates.MAIN_MENU`

---

## üì± –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (`MAIN_MENU`)

**–°–æ—Å—Ç–æ—è–Ω–∏–µ:** `PaymentStates.MAIN_MENU`

**–ö–Ω–æ–ø–∫–∏:**
1. üí≥ **–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É** ‚Üí `callback: payment:show_tariffs`
2. üéÅ **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø** ‚Üí `callback: payment:free_access`
3. üéüÔ∏è **–£ –º–µ–Ω—è –µ—Å—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥** ‚Üí `callback: payment:enter_promo`
4. ‚ùì **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?** ‚Üí `callback: payment:how_it_works` (TODO)

---

## üõ§Ô∏è –í–∞—Ä–∏–∞–Ω—Ç 1: –ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É

### –®–∞–≥ 1: –ü–æ–∫–∞–∑ —Ç–∞—Ä–∏—Ñ–æ–≤
**–ö–Ω–æ–ø–∫–∞:** üí≥ –ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É  
**Handler:** `show_tariffs_callback()`  
**State:** `PaymentStates.SELECTING_TARIFF`

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:**
- –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤
- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤:
  - üìÖ **–ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ ‚Äî 990‚ÇΩ**
  - üéØ **–ì–æ–¥–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ ‚Äî 6990‚ÇΩ (—Å–∫–∏–¥–∫–∞ 42%)**
- –ö–Ω–æ–ø–∫–∞ "¬´ –ù–∞–∑–∞–¥"

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã (–∏–∑ `config.py`):**
```python
'month': {
    'name': '–ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞',
    'price': 990,
    'currency': 'RUB',
    'duration_days': 30,
    'description': '–ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ 30 –¥–Ω–µ–π',
    'emoji': 'üìÖ'
},
'year': {
    'name': '–ì–æ–¥–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞',
    'price': 6990,
    'currency': 'RUB',
    'duration_days': 365,
    'description': '–ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≥–æ–¥ + —Å–∫–∏–¥–∫–∞ 42%',
    'discount': '42%',
    'emoji': 'üéØ'
}
```

### –®–∞–≥ 2: –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞
**–ö–Ω–æ–ø–∫–∏:** `payment:select_tariff:month` –∏–ª–∏ `payment:select_tariff:year`  
**Handler:** `select_tariff_callback()`  
**State:** `PaymentStates.CONFIRMING_TARIFF`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞—Ä–∏—Ñ –≤ `context.user_data['selected_tariff']`
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞—Ä–∏—Ñ–µ:
   - –ù–∞–∑–≤–∞–Ω–∏–µ –∏ emoji
   - –¶–µ–Ω–∞
   - –°–∫–∏–¥–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –û–ø–∏—Å–∞–Ω–∏–µ
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "‚úÖ –û–ø–ª–∞—Ç–∏—Ç—å"
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ç–∞—Ä–∏—Ñ–µ" (TODO)
5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "¬´ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Ç–∞—Ä–∏—Ñ"

### –®–∞–≥ 3: –û–ø–ª–∞—Ç–∞
**–ö–Ω–æ–ø–∫–∞:** ‚úÖ –û–ø–ª–∞—Ç–∏—Ç—å ‚Üí `callback: payment:pay:{tariff_id}`  
**Handler:** `pay_callback()`  
**State:** `PaymentStates.MAIN_MENU` (–≤–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é)

**TODO:** –í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É:
```
üöß –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –ü–õ–ê–¢–ï–ñ–ù–û–ô –°–ò–°–¢–ï–ú–û–ô

–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –º–æ–¥—É–ª—å –æ–ø–ª–∞—Ç—ã –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å:
‚Ä¢ YooKassa
‚Ä¢ CloudPayments
‚Ä¢ Prodamus

–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
1. –î–æ–±–∞–≤–∏—Ç—å API –∫–ª—é—á–∏ –≤ .env
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –≤ providers/
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–µ–±—Ö—É–∫–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ TEST –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
```

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å (–≤ –±—É–¥—É—â–µ–º):**
1. –í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –æ–ø–ª–∞—Ç—ã (YooKassa, CloudPayments, Prodamus)
2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ API
3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É
4. –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
5. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏

---

## üõ§Ô∏è –í–∞—Ä–∏–∞–Ω—Ç 2: –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø

### –®–∞–≥ 1: –ü–æ–∫–∞–∑ –æ–ø—Ü–∏–π
**–ö–Ω–æ–ø–∫–∞:** üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø  
**Handler:** `free_access_callback()`  
**State:** `PaymentStates.CHECKING_SUBSCRIPTION`

**–°–æ–æ–±—â–µ–Ω–∏–µ:** `FREE_ACCESS_CHANNEL`
```
üéÅ –•–û–¢–ò–¢–ï –ü–û–ü–†–û–ë–û–í–ê–¢–¨ –ë–ï–°–ü–õ–ê–¢–ù–û?

–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞—à Telegram-–∫–∞–Ω–∞–ª @TaktikaKutuzova –∏ –ø–æ–ª—É—á–∏—Ç–µ 2 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!

–í –∫–∞–Ω–∞–ª–µ:
‚Ä¢ –†–∞–∑–±–æ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂
‚Ä¢ –¢–µ—Ö–Ω–∏–∫–∏ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤
‚Ä¢ –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
‚Ä¢ –ò—Å—Ç–æ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

–ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–æ—Å—Ç–æ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å —Å—é–¥–∞ ‚Äî –¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
```

**–ö–Ω–æ–ø–∫–∏:**
1. üì¢ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª (URL –∫–Ω–æ–ø–∫–∞)
2. ‚úÖ –Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å ‚Üí `callback: payment:check_subscription`
3. üéüÔ∏è –í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥ ‚Üí `callback: payment:enter_promo`
4. ¬´ –ù–∞–∑–∞–¥ ‚Üí `callback: payment:back_to_menu`

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
**–ö–Ω–æ–ø–∫–∞:** ‚úÖ –Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å  
**Handler:** `check_subscription_callback()`  
**State:** `PaymentStates.MAIN_MENU`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `grant_channel_subscription_bonus()`
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª @TaktikaKutuzova
3. –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω –∏ –µ—â–µ –Ω–µ –ø–æ–ª—É—á–∞–ª –±–æ–Ω—É—Å:
   - –ù–∞—á–∏—Å–ª—è–µ—Ç—Å—è 2 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
4. –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω –∏–ª–∏ —É–∂–µ –ø–æ–ª—É—á–∞–ª:
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –£—Å–ø–µ—Ö: "–í—ã –ø–æ–ª—É—á–∏–ª–∏ 2 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!"
- ‚ùå –û—à–∏–±–∫–∞: "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –≤—ã —É–∂–µ –ø–æ–ª—É—á–∞–ª–∏ –±–æ–Ω—É—Å"

---

## üõ§Ô∏è –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–º–æ–∫–æ–¥

### –®–∞–≥ 1: –ù–∞—á–∞–ª–æ –≤–≤–æ–¥–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞
**–ö–Ω–æ–ø–∫–∞:** üéüÔ∏è –£ –º–µ–Ω—è –µ—Å—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥  
**Handler:** `enter_promo_callback()`  
**State:** `PromoInputStates.WAITING_CODE`

**–°–æ–æ–±—â–µ–Ω–∏–µ:** `FREE_ACCESS_PROMO`
```
üéâ –£ –í–ê–° –ï–°–¢–¨ –ü–†–û–ú–û–ö–û–î?

–í–≤–µ–¥–∏—Ç–µ –µ–≥–æ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å:
‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
‚Ä¢ –°–∫–∏–¥–∫—É –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É
‚Ä¢ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã

–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–¥ –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.
```

**–ö–Ω–æ–ø–∫–∏:**
- ¬´ –û—Ç–º–µ–Ω–∞ ‚Üí `callback: payment:cancel_promo`

**ConversationHandler –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è:**
- Entry point: `payment:enter_promo`
- State: `WAITING_CODE` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- Handler: `process_promocode()`

### –®–∞–≥ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞
**Handler:** `process_promocode()` (MessageHandler –¥–ª—è —Ç–µ–∫—Å—Ç–∞)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ö–æ–¥ –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ –≤–µ—Ä—Ö–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É: `code.upper()`
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `activate_promocode(code, telegram_id, session)`
3. –ü—Ä–æ–º–æ–∫–æ–¥ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è:
   - –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏
   - –ù–µ –∏—Å—Ç–µ–∫ –ª–∏ —Å—Ä–æ–∫
   - –ù–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏ –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
   - –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
4. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞–≥—Ä–∞–¥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞:
   - `trainings` ‚Üí –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
   - `free_month` ‚Üí –°–æ–∑–¥–∞–µ—Ç—Å—è –º–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
   - `credits` ‚Üí –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫—Ä–µ–¥–∏—Ç—ã
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ë–î
6. ConversationHandler –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è: `ConversationHandler.END`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –£—Å–ø–µ—Ö: "‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –í—ã –ø–æ–ª—É—á–∏–ª–∏ X —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫!"
- ‚ùå –û—à–∏–±–∫–∞: –†–∞–∑–ª–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∏—á–∏–Ω—ã

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è:**
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `/promo <–∫–æ–¥>` –ø—Ä—è–º–æ –≤ —á–∞—Ç–µ

---

## üîÑ –ù–∞–≤–∏–≥–∞—Ü–∏—è

### –ö–Ω–æ–ø–∫–∞ "¬´ –ù–∞–∑–∞–¥"
**Handler:** `back_to_menu_callback()`  
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (`MAIN_MENU`) —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç–∞—Ç—É—Å–µ.

### –ö–Ω–æ–ø–∫–∞ "¬´ –û—Ç–º–µ–Ω–∞"
**Handler:** `cancel_promo_callback()`  
–û—Ç–º–µ–Ω—è–µ—Ç –≤–≤–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.

### –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫—Ä—ã—Ç—å"
**Handler:** `close_callback()`  
–£–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.

---

## üìä –°–æ—Å—Ç–æ—è–Ω–∏—è (PaymentStates)

```python
MAIN_MENU = auto()              # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
SELECTING_TARIFF = auto()       # –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞
CONFIRMING_TARIFF = auto()      # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
SELECTING_PROVIDER = auto()     # –í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (TODO)
PROCESSING_PAYMENT = auto()     # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã (TODO)
WAITING_PAYMENT = auto()        # –û–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã (TODO)
ENTERING_PROMOCODE = auto()     # –í–≤–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞
VALIDATING_PROMOCODE = auto()   # –í–∞–ª–∏–¥–∞—Ü–∏—è (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
CHECKING_SUBSCRIPTION = auto() # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
```

---

## üéØ ConversationHandler –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–∞

**–¶–µ–ø–æ—á–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π:**
1. `WAITING_CODE` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –∫–æ–¥–∞ (—Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
3. `ConversationHandler.END` ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

**Fallbacks:**
- –ù–∞–∂–∞—Ç–∏–µ "–û—Ç–º–µ–Ω–∞"
- –õ—é–±–∞—è –∫–æ–º–∞–Ω–¥–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ–Ω–∞)

---

## üìù –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (from messages.py)

- `WELCOME_SALES` ‚Äî –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `FREE_ACCESS_CHANNEL` ‚Äî –û –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ
- `FREE_ACCESS_PROMO` ‚Äî –û –ø—Ä–æ–º–æ–∫–æ–¥–µ
- `NO_ACCESS` ‚Äî –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞
- `PAYMENT_SUCCESS` ‚Äî –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ (TODO)

---

## ‚ö†Ô∏è TODO / –ù–µ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏:**
   - YooKassa
   - CloudPayments
   - Prodamus

2. **–ö–Ω–æ–ø–∫–∞ "–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?"** (`payment:how_it_works`)

3. **–ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ç–∞—Ä–∏—Ñ–µ"** (`payment:tariff_details:{tariff_id}`)

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã** (–≤–µ–±—Ö—É–∫–∏)

5. **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏**

---

**–î–∞—Ç–∞:** 2025-10-28  
**–°—Ç–∞—Ç—É—Å:** –õ–æ–≥–∏–∫–∞ –æ–ø–∏—Å–∞–Ω–∞, –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

