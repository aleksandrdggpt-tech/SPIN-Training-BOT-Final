# üéâ SPIN Training Bot v4 ‚Äî –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

## ‚úÖ –ß—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

### üì¶ –°–æ–∑–¥–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
SPIN Training BOT Final/
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ payments/                       # üéØ –ú–û–î–£–õ–¨ –û–ü–õ–ê–¢–´ (–ø–µ—Ä–µ–Ω–æ—Å–∏–º—ã–π)
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py                 # –≠–∫—Å–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª—è
‚îÇ       ‚îú‚îÄ‚îÄ config.py                   # –¢–∞—Ä–∏—Ñ—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (990‚ÇΩ/6990‚ÇΩ)
‚îÇ       ‚îú‚îÄ‚îÄ messages.py                 # –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂ (8 —ç—Ç–∞–ø–æ–≤)
‚îÇ       ‚îú‚îÄ‚îÄ keyboards.py                # Telegram –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (10+ layouts)
‚îÇ       ‚îú‚îÄ‚îÄ states.py                   # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ subscription.py             # –õ–æ–≥–∏–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ + –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä
‚îÇ       ‚îú‚îÄ‚îÄ promocodes.py               # –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ handlers.py                 # Telegram –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ       ‚îî‚îÄ‚îÄ providers/                  # –ü–ª–∞—Ç–µ–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
‚îÇ           ‚îú‚îÄ‚îÄ __init__.py
‚îÇ           ‚îú‚îÄ‚îÄ base.py                 # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å PaymentProvider
‚îÇ           ‚îú‚îÄ‚îÄ yookassa.py             # YooKassa (stub)
‚îÇ           ‚îú‚îÄ‚îÄ cloudpayments.py        # CloudPayments (stub)
‚îÇ           ‚îî‚îÄ‚îÄ prodamus.py             # Prodamus (stub)
‚îÇ
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ models.py                       # 6 SQLAlchemy –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ database.py                     # Async –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
‚îÇ
‚îú‚îÄ‚îÄ REQUIREMENTS_v4.txt                 # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (10 –ø–∞–∫–µ—Ç–æ–≤)
‚îú‚îÄ‚îÄ .env.v4.example                     # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ README_v4.md                        # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (400+ —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ V4_INTEGRATION_GUIDE.md             # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ V4_SUMMARY.md                       # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ:** 21
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~3000+
- **–ú–æ–¥–µ–ª–µ–π –ë–î:** 6 (User, Subscription, Payment, Promocode, PromocodeUsage, FreeTraining)
- **–ü–ª–∞—Ç–µ–∂–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:** 3 (YooKassa, CloudPayments, Prodamus)
- **–¢–∞—Ä–∏—Ñ–æ–≤:** 6 (2 –ø–æ–¥–ø–∏—Å–∫–∏ + 4 –ø–∞–∫–µ—Ç–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤)
- **–¢–∏–ø–æ–≤ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤:** 3 (—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –º–µ—Å—è—Ü, –∫—Ä–µ–¥–∏—Ç—ã)
- **Telegram –∫–æ–º–∞–Ω–¥:** 3 (/payment, /buy, /subscribe)
- **Callback handlers:** 10+

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –º–æ–¥—É–ª—å `modules/payments/`
- ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –≤ –ª—é–±–æ–π –±–æ—Ç –∑–∞ 5 –º–∏–Ω—É—Ç
- ‚úÖ –ù–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ v3

### 2. –ú–æ–¥–µ–ª–∏ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏
- ‚úÖ **–ü–æ–¥–ø–∏—Å–∫–∏** (–º–µ—Å—è—Ü/–≥–æ–¥) ‚Äî –¥–ª—è SPIN Bot
- ‚úÖ **Pay-per-use** (–∫—Ä–µ–¥–∏—Ç—ã) ‚Äî –¥–ª—è –¥—Ä—É–≥–∏—Ö –±–æ—Ç–æ–≤
- ‚úÖ –õ–µ–≥–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏

### 3. –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ (—Å –¥–∞—Ç–æ–π –æ–∫–æ–Ω—á–∞–Ω–∏—è)
- ‚úÖ –ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ (—Å –ª–∏–º–∏—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä `@subscription_required` –¥–ª—è –∑–∞—â–∏—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π

### 4. –ü—Ä–æ–º–æ–∫–æ–¥—ã
- ‚úÖ 3 —Ç–∏–ø–∞: —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –º–µ—Å—è—Ü, –∫—Ä–µ–¥–∏—Ç—ã
- ‚úÖ –õ–∏–º–∏—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–Ω–∞ –ø—Ä–æ–º–æ–∫–æ–¥ –∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- ‚úÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API

### 5. –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø
- ‚úÖ 2 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª @TaktikaKutuzova
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ Bot API
- ‚úÖ –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –±–æ–Ω—É—Å (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è)

### 6. –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂
- ‚úÖ 8-—ç—Ç–∞–ø–Ω–∞—è –≤–æ—Ä–æ–Ω–∫–∞ —Å –¥–æ–∫–∞–∑–∞–Ω–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Å–∏–µ–π
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã (–ø–æ –º–µ—Ç–æ–¥—É Random Coffee People)
- ‚úÖ –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ + –≥–∞—Ä–∞–Ω—Ç–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

### 7. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Async SQLAlchemy 2.0
- ‚úÖ SQLite –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ª–µ–≥–∫–∏–π —Å—Ç–∞—Ä—Ç)
- ‚úÖ –õ–µ–≥–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PostgreSQL
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π

### 8. –ü–ª–∞—Ç–µ–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
- ‚úÖ –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `PaymentProvider`
- ‚úÖ 3 –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: YooKassa, CloudPayments, Prodamus
- ‚úÖ –ó–∞–≥–ª—É—à–∫–∏ –≥–æ—Ç–æ–≤—ã ‚Äî –æ—Å—Ç–∞–ª–æ—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è SPIN Bot (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π bot.py)

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r REQUIREMENTS_v4.txt

# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
python -c "import asyncio; from database import init_db; asyncio.run(init_db())"

# 3. –°–æ–∑–¥–∞—Ç—å .env
cp .env.v4.example .env
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å BOT_TOKEN –∏ OPENAI_API_KEY

# 4. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ bot.py (—Å–º. V4_INTEGRATION_GUIDE.md)
# - –î–æ–±–∞–≤–∏—Ç—å init_db() –∏ register_payment_handlers()
# - –î–æ–±–∞–≤–∏—Ç—å @subscription_required –∫ –∑–∞—â–∏—â–∞–µ–º—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å
python bot.py

# 6. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–æ–∫–æ–¥
# (—Å–º. V4_INTEGRATION_GUIDE.md —Ä–∞–∑–¥–µ–ª "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ")
```

### –î–ª—è –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ (—Å –Ω—É–ª—è)

```bash
# 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª–∏
cp -r modules/payments /path/to/new/bot/modules/
cp -r database /path/to/new/bot/

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install sqlalchemy aiosqlite python-telegram-bot

# 3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å handlers
from modules.payments.handlers import register_payment_handlers
register_payment_handlers(application)

# 4. –ó–∞—â–∏—Ç–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
@subscription_required
async def my_function(update, context):
    pass
```

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (15 –º–∏–Ω—É—Ç)
- [ ] `pip install -r REQUIREMENTS_v4.txt`
- [ ] –°–æ–∑–¥–∞—Ç—å `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å `BOT_TOKEN` + `OPENAI_API_KEY`
- [ ] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î (`init_db()`)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ `bot.py`
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å handlers (`register_payment_handlers()`)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `@subscription_required` –∫ –Ω—É–∂–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `/payment`
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ `TEST`

### –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (1-2 —á–∞—Å–∞)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (YooKassa/CloudPayments/Prodamus)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –≤ `providers/*.py`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–Ω–∞–ª –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—ã –≤ `config.py` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ö–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç—ã –≤–æ—Ä–æ–Ω–∫–∏ –≤ `messages.py`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–µ–±—Ö—É–∫–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø–ª–∞—Ç–µ–∂–∞—Ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å PostgreSQL (–¥–ª—è –ø—Ä–æ–¥–∞)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–ª–∞—Ç–µ–∂–µ–π

---

## üé® –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—ã

`modules/payments/config.py`:
```python
TARIFFS = {
    'month': {'price': 1490, ...},  # –ë—ã–ª–æ 990
    'year': {'price': 8990, ...}    # –ë—ã–ª–æ 6990
}
```

### –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏

```python
# –ü–æ–¥–ø–∏—Å–∫–∞ (SPIN Bot)
MONETIZATION_MODEL = 'subscription'

# Pay-per-use (–¥—Ä—É–≥–∏–µ –±–æ—Ç—ã)
MONETIZATION_MODEL = 'credits'
```

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ

```python
TARIFFS['half_year'] = {
    'name': '–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 6 –º–µ—Å—è—Ü–µ–≤',
    'price': 4990,
    'currency': 'RUB',
    'duration_days': 180,
    'description': '–ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–≥–æ–¥–∞',
    'emoji': '‚≠ê'
}
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ú–æ–¥–µ–ª–∏:**
- `User` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (telegram_id, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
- `Subscription` ‚Äî –ø–æ–¥–ø–∏—Å–∫–∏ (—Ç–∏–ø, —Å—Ä–æ–∫, –∫—Ä–µ–¥–∏—Ç—ã)
- `Payment` ‚Äî –ø–ª–∞—Ç–µ–∂–∏ (—Å—É–º–º–∞, –ø—Ä–æ–≤–∞–π–¥–µ—Ä, —Å—Ç–∞—Ç—É—Å)
- `Promocode` ‚Äî –ø—Ä–æ–º–æ–∫–æ–¥—ã (–∫–æ–¥, —Ç–∏–ø, –ª–∏–º–∏—Ç—ã)
- `PromocodeUsage` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- `FreeTraining` ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–∏—Å—Ç–æ—á–Ω–∏–∫, –æ—Å—Ç–∞—Ç–æ–∫)

**Relationships:**
- User ‚Üê one-to-many ‚Üí Subscription
- User ‚Üê one-to-many ‚Üí Payment
- User ‚Üê one-to-many ‚Üí PromocodeUsage
- User ‚Üê one-to-many ‚Üí FreeTraining
- Promocode ‚Üê one-to-many ‚Üí PromocodeUsage

### –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞

```
check_access(telegram_id)
  ‚Üì
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É
   - –í—Ä–µ–º–µ–Ω–Ω—É—é (–º–µ—Å—è—Ü/–≥–æ–¥) ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å end_date
   - –ö—Ä–µ–¥–∏—Ç–Ω—É—é ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å credits_left > 0
   ‚Üì
2. –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
   - –ï—Å—Ç—å trainings_left > 0?
   ‚Üì
3. –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ ‚Üí –≤–µ—Ä–Ω—É—Ç—å has_access=False
```

### –î–µ–∫–æ—Ä–∞—Ç–æ—Ä `@subscription_required`

```python
@subscription_required
async def protected_function(update, context):
    pass

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# 1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø
# 2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –æ–ø–ª–∞—Ç—ã
# 3. –ï—Å–ª–∏ –µ—Å—Ç—å ‚Üí —Å–ø–∏—Å—ã–≤–∞–µ—Ç –∫—Ä–µ–¥–∏—Ç/—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É (–¥–ª—è pay-per-use)
# 4. –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∫ —Ñ—É–Ω–∫—Ü–∏–∏
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **README_v4.md** ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, API, –ø—Ä–∏–º–µ—Ä—ã)
- **V4_INTEGRATION_GUIDE.md** ‚Äî –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **V4_SUMMARY.md** ‚Äî –≠—Ç–æ—Ç —Ñ–∞–π–ª (–∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞)
- **Docstrings** ‚Äî –í–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö –º–æ–¥—É–ª—è

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è (v4.0)

1. **–ü–ª–∞—Ç–µ–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∑–∞–≥–ª—É—à–∫–∏
   - –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã `create_payment()`, `check_payment_status()`, `refund()`
   - –¢—Ä–µ–±—É–µ—Ç API –∫–ª—é—á–∏ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

2. **–í–µ–±—Ö—É–∫–∏** ‚Äî –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
   - –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å endpoints –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

3. **–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ** ‚Äî –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
   - –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å cron-–∑–∞–¥–∞—á—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å recurring payments

4. **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** ‚Äî –Ω–µ—Ç UI
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∫–æ–¥
   - –ù—É–∂–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/admin` —Å –º–µ–Ω—é

5. **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö v3‚Üív4** ‚Äî –Ω—É–∂–µ–Ω —Å–∫—Ä–∏–ø—Ç
   - UserService (dict) ‚Üí SQLAlchemy models
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### Roadmap v4.1

- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–µ–±—Ö—É–∫–∏
- [ ] –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫
- [ ] –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–∫–æ–º–∞–Ω–¥–∞ `/admin`)
- [ ] –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ v3‚Üív4
- [ ] –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Ä–æ–Ω–∫–∏
- [ ] Telegram Stars integration

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ SPIN Bot

1. ‚úÖ **–ü—Ä–æ—á–∏—Ç–∞—Ç—å** `V4_INTEGRATION_GUIDE.md`
2. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å** –º–æ–¥—É–ª—å –≤ —Ç–µ–∫—É—â–∏–π `bot.py`
3. ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –ª–æ–∫–∞–ª—å–Ω–æ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º `TEST`
4. ‚úÖ **–í—ã–±—Ä–∞—Ç—å** –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (YooKassa/CloudPayments/Prodamus)
5. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å** –º–µ—Ç–æ–¥—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
6. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å** –≤–µ–±—Ö—É–∫–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
7. ‚úÖ **–ó–∞–¥–µ–ø–ª–æ–∏—Ç—å** –Ω–∞ Railway
8. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç—å** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞

1. ‚úÖ **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å** `modules/payments/` –∏ `database/` –≤ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç
2. ‚úÖ **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å** –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
3. ‚úÖ **–ò–∑–º–µ–Ω–∏—Ç—å** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (`config.py`)
4. ‚úÖ **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å** handlers
5. ‚úÖ **–ó–∞—â–∏—Ç–∏—Ç—å** —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º
6. ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**
7. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç—å**

---

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ v4

### –î–ª—è –±–∏–∑–Ω–µ—Å–∞
- üí∞ –ì–æ—Ç–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏
- üìà –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂
- üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥—ã –¥–ª—è –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π
- üìä –ü–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
- üöÄ –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (15 –º–∏–Ω—É—Ç)
- üì¶ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ª–µ–≥–∫–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å)
- üîß –õ–µ–≥–∫–æ –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å (–∫–æ–Ω—Ñ–∏–≥ + —Ç–µ–∫—Å—Ç—ã)
- üõ°Ô∏è –ó–∞—â–∏—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–π –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π (`@subscription_required`)
- üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üí≥ –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã
- üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø (–∫–∞–Ω–∞–ª + –ø—Ä–æ–º–æ–∫–æ–¥—ã)
- üîÑ –ì–∞—Ä–∞–Ω—Ç–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞
- üìä –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏

---

## üèÜ –ò—Ç–æ–≥–æ

### –°–æ–∑–¥–∞–Ω–æ –∑–∞ —Å–µ—Å—Å–∏—é

- ‚úÖ **21 —Ñ–∞–π–ª** —Å —á–∏—Å—Ç—ã–º, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–æ–¥–æ–º
- ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π –º–æ–¥—É–ª—å** –æ–ø–ª–∞—Ç—ã
- ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** —Å 6 –º–æ–¥–µ–ª—è–º–∏
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤** —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ **–í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂** —Å –∫–æ–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏
- ‚úÖ **3 –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞** (–∑–∞–≥–ª—É—à–∫–∏)
- ‚úÖ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (3 MD —Ñ–∞–π–ª–∞)
- ‚úÖ **–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** (–ø–æ—à–∞–≥–æ–≤–æ–µ)

### –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø—Ä–æ–º–æ–∫–æ–¥—ã)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π bot.py
- ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å –≤ –¥—Ä—É–≥–∏–µ –±–æ—Ç—ã
- ‚è≥ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (API –∫–ª—é—á–∏ –Ω—É–∂–Ω—ã)
- ‚è≥ –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `README_v4.md`
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** `V4_INTEGRATION_GUIDE.md`
- **Telegram:** @TaktikaKutuzova

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**SPIN Training Bot v4 –≥–æ—Ç–æ–≤!**

–ú–æ–¥—É–ª—å –æ–ø–ª–∞—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. –°–ª–µ–¥—É–π—Ç–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É `V4_INTEGRATION_GUIDE.md` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è:**
- ‚úÖ –õ–µ–≥–∫–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ —Ç–µ–∫—É—â–∏–π bot.py
- ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ (–æ—Ç SQLite –¥–æ PostgreSQL)
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏ (–ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏)

**–£—Å–ø–µ—Ö–æ–≤ –≤ –∑–∞–ø—É—Å–∫–µ! üöÄ**
