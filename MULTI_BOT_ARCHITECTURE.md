# ‚úÖ Multi-Bot –°–∏—Å—Ç–µ–º–∞ - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## üéØ –í–æ–ø—Ä–æ—Å: –ï–¥–∏–Ω–∞—è –ë–î –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–æ—Ç–æ–≤?

### ‚úÖ –û–¢–í–ï–¢: –î–ê! –£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û! ‚úÖ

---

## üìä –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. ‚úÖ –ï–î–ò–ù–ê–Ø –ë–î –î–õ–Ø –ù–ï–°–ö–û–õ–¨–ö–ò–• –ë–û–¢–û–í

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```
PostgreSQL (Railway)
‚îú‚îÄ‚îÄ users (–û–ë–©–ê–Ø)
‚îÇ   ‚îú‚îÄ‚îÄ telegram_id (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
‚îÇ   ‚îú‚îÄ‚îÄ total_xp (–∫—Ä–æ—Å—Å-–±–æ—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ level (–∫—Ä–æ—Å—Å-–±–æ—Ç)
‚îÇ   ‚îî‚îÄ‚îÄ badges (–æ–±—â–∏–µ)
‚îÇ
‚îú‚îÄ‚îÄ bot_sessions (–ò–ó–û–õ–Ø–¶–ò–Ø)
‚îÇ   ‚îú‚îÄ‚îÄ user_id ‚Üí users.id
‚îÇ   ‚îú‚îÄ‚îÄ bot_name ("spin_bot", "quiz_bot", ...)
‚îÇ   ‚îú‚îÄ‚îÄ session_data (JSON - –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–æ—Ç–∞)
‚îÇ   ‚îî‚îÄ‚îÄ stats_data (JSON - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–æ—Ç–∞)
‚îÇ
‚îú‚îÄ‚îÄ badges (–û–ë–©–ê–Ø)
‚îÇ   ‚îú‚îÄ‚îÄ name, description
‚îÇ   ‚îî‚îÄ‚îÄ criteria
‚îÇ
‚îú‚îÄ‚îÄ promocodes (–û–ë–©–ê–Ø)
‚îÇ   ‚îú‚îÄ‚îÄ code, type, value
‚îÇ   ‚îî‚îÄ‚îÄ uses_left
‚îÇ
‚îú‚îÄ‚îÄ subscriptions (–û–ë–©–ê–Ø)
‚îÇ   ‚îú‚îÄ‚îÄ user_id
‚îÇ   ‚îî‚îÄ‚îÄ type, expires_at
‚îÇ
‚îî‚îÄ‚îÄ payments (–û–ë–©–ê–Ø)
    ‚îú‚îÄ‚îÄ user_id
    ‚îî‚îÄ‚îÄ amount, status
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```python
# –ü—Ä–∏–º–µ—Ä: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 123456

User:
  telegram_id = 123456
  total_xp = 500  # ‚Üê –∏–∑ spin_bot + quiz_bot + –¥—Ä—É–≥–∏—Ö
  level = 5       # ‚Üê –æ–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å

BotSession:
  bot_name = "spin_bot"
  session_data = {"question_count": 5, "clarity": 75}
  stats_data = {"total_trainings": 10}  # ‚Üê –¥–∞–Ω–Ω—ã–µ SPIN –±–æ—Ç–∞

BotSession:
  bot_name = "quiz_bot"
  session_data = {"current_question": 3, "score": 120}
  stats_data = {"quizzes_completed": 5}  # ‚Üê –¥–∞–Ω–Ω—ã–µ quiz_bot

# –û–ë–©–ò–ï –¥–∞–Ω–Ω—ã–µ:
- badges (–≤—ã–¥–∞–Ω–Ω—ã–µ –≤–æ –í–°–ï–• –±–æ—Ç–∞—Ö)
- promocodes (—Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –í–°–ï–• –±–æ—Ç–æ–≤)
- subscriptions (—Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –í–°–ï–• –±–æ—Ç–æ–≤)
```

---

### 2. ‚úÖ –ï–î–ò–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ù–ê–ì–†–ê–î (Badges)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –¢–∞–±–ª–∏—Ü–∞ `badges` - –û–ë–©–ê–Ø
- –¢–∞–±–ª–∏—Ü–∞ `badge_user_association` - –û–ë–©–ê–Ø
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç XP –≤–æ –≤—Å–µ—Ö –±–æ—Ç–∞—Ö ‚Üí –æ–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å
- –ë–µ–π–¥–∂–∏ –≤—ã–¥–∞—é—Ç—Å—è –≤ –ª—é–±–æ–º –±–æ—Ç–µ ‚Üí –≤–∏–¥–Ω—ã –≤–æ –≤—Å–µ—Ö –±–æ—Ç–∞—Ö

**–ü—Ä–∏–º–µ—Ä:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–≥—Ä–∞–µ—Ç –≤ spin_bot:
- –ó–∞–≤–µ—Ä—à–∏–ª —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
- –ü–æ–ª—É—á–∏–ª XP ‚Üí total_xp –ø–æ–≤—ã—Å–∏–ª—Å—è
- –ü–æ–ª—É—á–∏–ª –±–µ–π–¥–∂ "–ü–µ—Ä–≤—ã–π —à–∞–≥"

–¢–æ—Ç –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ quiz_bot:
- –í–∏–¥–∏—Ç —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å (–∏–∑ spin_bot)
- –í–∏–¥–∏—Ç –±–µ–π–¥–∂ "–ü–µ—Ä–≤—ã–π —à–∞–≥" (–∏–∑ spin_bot)
- –ü–æ–ª—É—á–∞–µ—Ç XP –∑–∞ –∫–≤–∏–∑ ‚Üí total_xp —Ä–∞—Å—Ç—ë—Ç
```

---

### 3. ‚úÖ –ï–î–ò–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ü–†–û–ú–û–ö–û–î–û–í

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –¢–∞–±–ª–∏—Ü–∞ `promocodes` - –û–ë–©–ê–Ø
- –¢–∞–±–ª–∏—Ü–∞ `promocode_usage` - –û–ë–©–ê–Ø
- –ü—Ä–æ–º–æ–∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –í–°–ï–• –±–æ—Ç–∞—Ö
- –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –æ–±—â—É—é —Ç–∞–±–ª–∏—Ü—É

**–ü—Ä–∏–º–µ—Ä:**
```python
# –ü—Ä–æ–º–æ–∫–æ–¥ "WELCOME2024"
# –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ spin_bot, quiz_bot, –∏ —Ç.–¥.
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –µ–¥–∏–Ω—É—é –ë–î
```

---

### 4. ‚úÖ –ï–î–ò–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ü–û–î–ü–ò–°–û–ö/–ü–õ–ê–¢–ï–ñ–ï–ô

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –¢–∞–±–ª–∏—Ü–∞ `subscriptions` - –û–ë–©–ê–Ø
- –¢–∞–±–ª–∏—Ü–∞ `payments` - –û–ë–©–ê–Ø
- –ü–æ–¥–ø–∏—Å–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –í–°–ï–• –±–æ—Ç–∞—Ö
- –ü–ª–∞—Ç–µ–∂–∏ –≤–∏–¥–Ω—ã –≤–µ–∑–¥–µ

---

## üìã –ß–¢–û –°–î–ï–õ–ê–ù–û –ò–ó –í–ê–®–ï–ì–û –°–ü–ò–°–ö–ê

### ‚úÖ 1. –§–∞–π–ª spin_bot.db –ù–ï —Å–æ–∑–¥–∞–µ—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL)
**–°–¢–ê–¢–£–°:** ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û
- **–õ–æ–∫–∞–ª—å–Ω–æ:** SQLite (–¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è event loop –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
- **Railway:** PostgreSQL —á–µ—Ä–µ–∑ `DATABASE_URL`
- **–¢–∞–±–ª–∏—Ü—ã:** PostgreSQL —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `init_db()`
- **–ú–∏–≥—Ä–∞—Ü–∏—è:** –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å SQLite –Ω–∞ PostgreSQL –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∑–∞–Ω–æ–≤–æ

### ‚úÖ 2. –í Railway –≤–∏–¥–Ω—ã —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
**–°–¢–ê–¢–£–°:** ‚úÖ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ
- `init_db()` —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –¢–∞–±–ª–∏—Ü—ã: `users`, `bot_sessions`, `badges`, `promocodes`, `subscriptions`, `payments`, `training_history`

### ‚úÖ 3. /start —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
**–°–¢–ê–¢–£–°:** ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
- –í `services/user_service_db.py` -> `get_user_data()`
- –í `database/repositories/user_repository.py` -> `get_or_create()`
- –ü—Ä–∏ `/start` —Å–æ–∑–¥–∞—ë—Ç—Å—è User –∏ BotSession

### ‚úÖ 4. –ü–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –±–æ—Ç–∞ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
**–°–¢–ê–¢–£–°:** ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
- –î–∞–Ω–Ω—ã–µ –≤ PostgreSQL —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- `save_user_data()` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ë–î
- `save_session()` –æ–±–Ω–æ–≤–ª—è–µ—Ç BotSession

### ‚úÖ 5. users_data.json –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
**–°–¢–ê–¢–£–°:** ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û
- ‚úÖ `services/user_service_db.py` –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON
- ‚ö†Ô∏è `services/user_service_persistent.py` –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON (legacy)
- ‚úÖ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `user_service_db.py` (–∏–∑ `bot.py`)
- **–í—ã–≤–æ–¥:** –ù–æ–≤—ã–π –±–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ PostgreSQL, —Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ JSON –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### ‚úÖ 6. –ú–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å database/ –≤ –¥—Ä—É–≥–æ–π –ø—Ä–æ–µ–∫—Ç
**–°–¢–ê–¢–£–°:** ‚úÖ –ì–û–¢–û–í–û
- `database/` - –ø–µ—Ä–µ–Ω–æ—Å–∏–º—ã–π –º–æ–¥—É–ª—å
- –í `database/README.md` –µ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –í—Å–µ –º–æ–¥–µ–ª–∏ –≤ `base_models.py` –¥–ª—è multi-bot
- `bot_name` –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏

### ‚úÖ 7. README.md —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ —Å–æ–∑–¥–∞–Ω
**–°–¢–ê–¢–£–°:** ‚úÖ –°–û–ó–î–ê–ù
- `database/README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è
- `README_v4.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è v4.0
- `V4_INTEGRATION_GUIDE.md` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- `RAILWAY_DEPLOY_v4.md` - –¥–µ–ø–ª–æ–π
- `LOCAL_DEVELOPMENT_SETUP.md` - –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

---

## üéØ –ö–ê–ö –î–û–ë–ê–í–ò–¢–¨ –ù–û–í–´–ô –ë–û–¢

### –®–∞–≥ 1: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ database/

```bash
cd /path/to/new_bot/
cp -r /path/to/spin_bot/database/ .
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r REQUIREMENTS_v4.txt
```

### –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ DatabaseService

```python
from services.database_service import DatabaseService

db_service = DatabaseService(bot_name="new_bot_name")

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_data = await db_service.get_user_session(telegram_id=123456)
# user_data - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ª—é–±–æ–≥–æ –±–æ—Ç–∞

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
await db_service.save_session(telegram_id, session, stats)
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env

```bash
DATABASE_URL=postgresql://... (—Ç–∞ –∂–µ –ë–î Railway)
```

**–ì–æ—Ç–æ–≤–æ!** –ù–æ–≤—ã–π –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ –ë–î:
- ‚úÖ –¢–µ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- ‚úÖ –û–±—â–∏–µ XP, levels, badges
- ‚úÖ –°–≤–æ—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è session/stats

---

## üîÆ –ò–¢–û–ì–û

**–ï–î–ò–ù–ê–Ø –ë–î –£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê:**
- ‚úÖ Multi-bot –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –±–æ—Ç–∞–º —á–µ—Ä–µ–∑ `bot_name`
- ‚úÖ –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ (users, badges, promocodes)
- ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å–∏–º—ã–π –º–æ–¥—É–ª—å `database/`

**–ß–¢–û –ù–£–ñ–ù–û –î–õ–Ø RAILWAY:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å `git push`
- ‚úÖ Railway —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ PostgreSQL URL –±—É–¥–µ—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ß–¢–û –£–ñ–ï –†–ê–ë–û–¢–ê–ï–¢:**
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (SQLite)
- ‚úÖ Multi-bot –∏–∑–æ–ª—è—Ü–∏—è
- ‚úÖ –ö—Ä–æ—Å—Å-–±–æ—Ç –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –ï–¥–∏–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã/–ø–æ–¥–ø–∏—Å–∫–∏

---

**–í—Å—ë –≥–æ—Ç–æ–≤–æ! –ú–æ–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Railway –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –±–æ—Ç—ã! üöÄ**


