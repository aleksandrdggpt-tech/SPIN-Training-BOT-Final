# ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å Async –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

## –ü—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞:**
```
RuntimeError: Task got Future attached to a different loop
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- Telegram Bot –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `python-telegram-bot` –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç event loop
- –í—Å–µ handler'—ã –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ **sync** —Ñ—É–Ω–∫—Ü–∏–∏
- –ù–æ PostgreSQL —á–µ—Ä–µ–∑ asyncpg —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ **async** –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- –ö–æ–≥–¥–∞ sync handler –≤—ã–∑—ã–≤–∞–µ—Ç `asyncio.run()` –≤–Ω—É—Ç—Ä–∏ —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ loop ‚Üí –∫–æ–Ω—Ñ–ª–∏–∫—Ç

## üîß –†–µ—à–µ–Ω–∏–µ 1: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SQLite –ª–æ–∫–∞–ª—å–Ω–æ

**–í `.env`:**
```bash
DATABASE_URL=sqlite+aiosqlite:///./spin_bot_test.db
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PostgreSQL
- ‚úÖ –ë—ã—Å—Ç—Ä–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å Railway
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ PostgreSQL –¥–ª—è –¥–µ–ø–ª–æ—è

## üîß –†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ sync –¥—Ä–∞–π–≤–µ—Ä psycopg

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å: `pip install psycopg2-binary`
- –ò–∑–º–µ–Ω–∏—Ç—å engine –Ω–∞: `postgresql://...` (–±–µ–∑ +asyncpg)
- –£–±—Ä–∞—Ç—å async/await –∏–∑ database –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü–ª—é—Å—ã:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ sync –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- ‚úÖ PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ
- ‚ö†Ô∏è –¢–µ—Ä—è–µ—Ç—Å—è async performance

## üîß –†–µ—à–µ–Ω–∏–µ 3: –ü–æ–ª–Ω–æ—Å—Ç—å—é async –±–æ—Ç

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `bot.py`:**
- –í—Å–µ handler'—ã —Å–¥–µ–ª–∞—Ç—å async
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å async –¥–ª—è –≤—Å–µ—Ö –ë–î –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ event loops

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å–µ handlers

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–î–ª—è —Å–µ–π—á–∞—Å:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SQLite –ª–æ–∫–∞–ª—å–Ω–æ
2. –ù–∞ Railway –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ PostgreSQL

**–î–ª—è –±—É–¥—É—â–µ–≥–æ:**
1. –ü–µ—Ä–µ–¥–µ–ª–∞–π—Ç–µ –±–æ—Ç –Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é async –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ psycopg –¥–ª—è sync –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è


