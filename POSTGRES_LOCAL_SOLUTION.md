# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã PostgreSQL –ª–æ–∫–∞–ª—å–Ω–æ

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

PostgreSQL —á–µ—Ä–µ–∑ asyncpg —Ç—Ä–µ–±—É–µ—Ç event loop, –Ω–æ Telegram Bot —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π event loop. –≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç:
```
RuntimeError: Task got Future attached to a different loop
```

## ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SQLite –ª–æ–∫–∞–ª—å–Ω–æ, PostgreSQL –Ω–∞ Railway:**

### –í `.env` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

```bash
# SQLite –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ)
DATABASE_URL=sqlite+aiosqlite:///./spin_bot_test.db

# PostgreSQL –¥–ª—è production –Ω–∞ Railway
# DATABASE_URL=postgresql://postgres:pass@switchback.proxy.rlwy.net:10308/railway
```

### –ù–∞ Railway:

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `DATABASE_URL`.

---

## üéØ –ß—Ç–æ –¥–µ–ª–∞—Ç—å

**–°–µ–π—á–∞—Å –≤ `.env` —Å—Ç–æ–∏—Ç PostgreSQL URL. –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ SQLite:**

```bash
DATABASE_URL=sqlite+aiosqlite:///./spin_bot_test.db
```

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
python bot.py
```

---

## üìä –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

- ‚úÖ **–õ–æ–∫–∞–ª—å–Ω–æ:** SQLite –Ω–µ —Ç—Ä–µ–±—É–µ—Ç event loop –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ sync –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- ‚úÖ **–ù–∞ Railway:** PostgreSQL –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —Ç–∞–º –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å Telegram Bot event loop (–∏–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥—Ä—É–≥–∞—è)
- ‚úÖ **–î–∞–Ω–Ω—ã–µ:** –ö–∞–∂–¥—ã–π environment –∏–º–µ–µ—Ç —Å–≤–æ—é –ë–î - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –ù–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∫–æ–¥–∞

---

## üîÆ –î–ª—è –±—É–¥—É—â–µ–≥–æ

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω PostgreSQL –ª–æ–∫–∞–ª—å–Ω–æ:
1. –ü–µ—Ä–µ–¥–µ–ª–∞–π—Ç–µ –≤—Å–µ handlers –Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é async
2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `psycopg2` (sync –¥—Ä–∞–π–≤–µ—Ä) –≤–º–µ—Å—Ç–æ asyncpg
3. –û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ

**–ü–æ–∫–∞ —á—Ç–æ - SQLite –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –ø—É—Ç—å!**


