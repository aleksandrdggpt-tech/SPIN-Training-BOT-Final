# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª

## –û–ø–∏—Å–∞–Ω–∏–µ

–ë–æ—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ Telegram-–∫–∞–Ω–∞–ª [@TaktikaKutuzova](https://t.me/TaktikaKutuzova).

## –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã

### 1. –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω

–ù–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ (–º–µ–Ω—é –æ–ø–ª–∞—Ç—ã) –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ **"üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø"** (`payment:free_access`).

**–§–∞–π–ª:** `modules/payments/keyboards.py` ‚Üí `get_payment_menu_keyboard()`

### 2. –ú–µ–Ω—é –ø–æ–¥–ø–∏—Å–∫–∏

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –º–µ–Ω—é —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª.

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** `modules/payments/handlers.py` ‚Üí `free_access_callback()`

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `modules/payments/keyboards.py` ‚Üí `get_free_access_keyboard()`

–ú–µ–Ω—é —Å–æ–¥–µ—Ä–∂–∏—Ç:
- **"üì¢ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª"** ‚Äî –∫–Ω–æ–ø–∫–∞ —Å–æ —Å—Å—ã–ª–∫–æ–π `https://t.me/TaktikaKutuzova` (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞–Ω–∞–ª –≤ Telegram)
- **"‚úÖ –Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å"** ‚Äî –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ (`payment:check_subscription`)
- **"üéüÔ∏è –í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥"** ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- **"¬´ –ù–∞–∑–∞–¥"** ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "–Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å" –±–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** `modules/payments/handlers.py` ‚Üí `check_subscription_callback()`

**–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏:** `modules/payments/subscription.py` ‚Üí `check_channel_subscription()`

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞:

1. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ Telegram Bot API `getChatMember`
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–∞–Ω–∞–ª–µ `@TaktikaKutuzova`
3. –ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã: `MEMBER`, `ADMINISTRATOR`, `CREATOR`
4. –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã: `LEFT`, `KICKED`, `RESTRICTED`

```python
member = await bot.get_chat_member(
    chat_id='@TaktikaKutuzova',
    user_id=telegram_id
)
is_subscribed = member.status in [
    ChatMemberStatus.MEMBER,
    ChatMemberStatus.ADMINISTRATOR,
    ChatMemberStatus.CREATOR
]
```

### 4. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

#### –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –ø–æ–¥–ø–∏—Å–∞–Ω:

- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ: "‚ùå –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
- –ü—Ä–æ—Å—å–±–∞ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª –∏ –Ω–∞–∂–∞—Ç—å "–Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è" –µ—â–µ —Ä–∞–∑
- –ú–µ–Ω—é –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏

#### –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω:

1. **–í—ã–¥–∞–µ—Ç—Å—è –±–æ–Ω—É—Å** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –ø–æ–ª—É—á–∞–ª):
   - –§—É–Ω–∫—Ü–∏—è: `grant_channel_subscription_bonus()`
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 2 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `FreeTrainingSource.CHANNEL`
   - –ë–æ–Ω—É—Å –≤—ã–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

2. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø**:
   - –§—É–Ω–∫—Ü–∏—è: `check_access()`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ –∏–ª–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

3. **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
   - –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø ‚Üí –∫–Ω–æ–ø–∫–∞ **"‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É"**
   - –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–∞ –Ω–µ—Ç ‚Üí –º–µ–Ω—é –æ–ø–ª–∞—Ç—ã

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã:

1. **`modules/payments/keyboards.py`**
   - `get_payment_menu_keyboard()` ‚Äî –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–æ–π "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø"
   - `get_free_access_keyboard()` ‚Äî –º–µ–Ω—é –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª

2. **`modules/payments/handlers.py`**
   - `free_access_callback()` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø"
   - `check_subscription_callback()` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏

3. **`modules/payments/subscription.py`**
   - `check_channel_subscription()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ `getChatMember`
   - `grant_channel_subscription_bonus()` ‚Äî –≤—ã–¥–∞—á–∞ –±–æ–Ω—É—Å–∞ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É
   - `check_access()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

4. **`modules/payments/config.py`**
   - `CHANNEL_USERNAME = 'TaktikaKutuzova'` ‚Äî –∏–º—è –∫–∞–Ω–∞–ª–∞
   - `FREE_TRAININGS_FOR_SUBSCRIPTION = 2` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

–í `modules/payments/handlers.py` ‚Üí `register_payment_handlers()`:

```python
application.add_handler(CallbackQueryHandler(
    free_access_callback,
    pattern="^payment:free_access$"
))
application.add_handler(CallbackQueryHandler(
    check_subscription_callback,
    pattern="^payment:check_subscription$"
))
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª–∞** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `getChatMember`
2. **–ë–æ–Ω—É—Å –≤—ã–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑** ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –¥–∞–µ—Ç –Ω–æ–≤—ã–π –±–æ–Ω—É—Å
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω –≤ –º–æ–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
4. **–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã ChatMemberStatus** –∏–∑ `telegram.constants` –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí "üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø"
              ‚Üì
         –ú–µ–Ω—é –ø–æ–¥–ø–∏—Å–∫–∏
              ‚Üì
    "üì¢ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª" (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞–Ω–∞–ª)
              ‚Üì
    "‚úÖ –Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å"
              ‚Üì
    –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á–µ—Ä–µ–∑ getChatMember
              ‚Üì
    –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω ‚Üí –í—ã–¥–∞–µ—Ç 2 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ ‚Üí "‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É"
    –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ü—Ä–æ—Å–∏—Ç –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è —Å–Ω–æ–≤–∞
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-16

