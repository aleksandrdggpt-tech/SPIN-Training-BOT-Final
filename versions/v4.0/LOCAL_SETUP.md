# ðŸ–¥ï¸ Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¸ Ð·Ð°Ð¿ÑƒÑÐº v4.0

## âœ… Ð”Ð°, v4.0 Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾!

Ð’ÐµÑ€ÑÐ¸Ñ v4.0 Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ñ SQLite Ñ‡ÐµÑ€ÐµÐ· Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ `DEV_MODE=1`.

## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

### 1. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ v4.0:
```bash
cd versions/v4.0
```

### 2. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ (ÐµÑÐ»Ð¸ ÐµÑ‰Ðµ Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹):
```bash
pip install -r requirements.txt
```

### 3. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» `.env` Ð¸Ð»Ð¸ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ:
```bash
# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ .env Ñ„Ð°Ð¹Ð»
cat > .env << EOF
BOT_TOKEN=your_bot_token_here
DEV_MODE=1
EOF

# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
export BOT_TOKEN="your_bot_token_here"
export DEV_MODE=1
```

### 4. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð±Ð¾Ñ‚Ð°:
```bash
python bot.py
```

## ðŸ“‹ ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°

**ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð½Ð°Ð±Ð¾Ñ€:**
```bash
BOT_TOKEN=your_bot_token_here  # Ð¢Ð¾ÐºÐµÐ½ Ð¾Ñ‚ @BotFather
DEV_MODE=1                     # Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ SQLite Ð²Ð¼ÐµÑÑ‚Ð¾ PostgreSQL
```

**ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ (Ð´Ð»Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸):**
```bash
OPENAI_API_KEY=your_key        # Ð”Ð»Ñ LLM Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
ANTHROPIC_API_KEY=your_key     # ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ LLM Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€
SCENARIO_PATH=scenarios/spin_sales/config.json
```

## ðŸ”§ ÐšÐ°Ðº ÑÑ‚Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚

### Ð ÐµÐ¶Ð¸Ð¼ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ (DEV_MODE=1):
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ SQLite (`sqlite+aiosqlite:///./spin_bot.db`)
- âœ… ÐÐµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ PostgreSQL
- âœ… Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð² Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸
- âœ… Ð˜Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾ Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¸ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ

### Production Ñ€ÐµÐ¶Ð¸Ð¼ (DEV_MODE=0 Ð¸Ð»Ð¸ Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½):
- âš ï¸ Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ `DATABASE_URL` Ñ PostgreSQL
- âš ï¸ ÐÐµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑÑ Ð±ÐµÐ· Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº PostgreSQL
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð½Ð° Railway/Heroku

## ðŸ› Ð ÐµÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: "DATABASE_URL is not set"
**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ `DEV_MODE=1`:
```bash
export DEV_MODE=1
python bot.py
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: "No module named 'aiosqlite'"
**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸:
```bash
pip install aiosqlite
# Ð¸Ð»Ð¸
pip install -r requirements.txt
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: "Permission denied" Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð‘Ð”
**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° Ð·Ð°Ð¿Ð¸ÑÑŒ Ð² Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ:
```bash
ls -la spin_bot.db  # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ Ñ„Ð°Ð¹Ð»
chmod 644 spin_bot.db  # Ð•ÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾
```

## ðŸ“ ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¿Ð¾Ð»Ð½Ð¾Ð³Ð¾ .env Ñ„Ð°Ð¹Ð»Ð° Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸

```env
# Telegram Bot
BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz

# Development Mode (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ SQLite)
DEV_MODE=1

# LLM Providers (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð½Ð¾ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)
OPENAI_API_KEY=sk-proj-...
ANTHROPIC_API_KEY=sk-ant-api03-...

# Scenario
SCENARIO_PATH=scenarios/spin_sales/config.json

# LLM Settings
LLM_TIMEOUT_SEC=30.0
LLM_MAX_RETRIES=1
RESPONSE_PROVIDER=anthropic
FEEDBACK_PROVIDER=anthropic
CLASSIFICATION_PROVIDER=openai

# Server (Ð´Ð»Ñ health check)
PORT=8080

# Database Pool (Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð² SQLite, Ð½Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ)
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=0

# PID File (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸)
WRITE_PID_FILE=0
```

## âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿ÐµÑ€ÐµÐ´ Ð·Ð°Ð¿ÑƒÑÐºÐ¾Ð¼

```bash
# 1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸
pwd  # Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ: .../versions/v4.0

# 2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
echo $BOT_TOKEN
echo $DEV_MODE  # Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ: 1

# 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ
python3 -m py_compile bot.py

# 4. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð±Ð¾Ñ‚Ð°
python bot.py
```

## ðŸŽ¯ ÐžÑ‚Ð»Ð¸Ñ‡Ð¸Ñ Ð¾Ñ‚ production

| ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ | Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ (DEV_MODE=1) | Production (Railway) |
|----------|----------------------|---------------------|
| Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… | SQLite (Ñ„Ð°Ð¹Ð») | PostgreSQL (ÑÐµÑ€Ð²ÐµÑ€) |
| DATABASE_URL | ÐÐµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ | ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½ |
| DEV_MODE | `1` | `0` Ð¸Ð»Ð¸ Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ |
| Ð¤Ð°Ð¹Ð» Ð‘Ð” | `./spin_bot.db` | ÐÐ° ÑÐµÑ€Ð²ÐµÑ€Ðµ Railway |

## ðŸ’¡ Ð¡Ð¾Ð²ÐµÑ‚Ñ‹

1. **ÐÐµ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚ÑŒÑ‚Ðµ `spin_bot.db`** - Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð² `.gitignore`
2. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ñ‚Ð¾ÐºÐµÐ½Ñ‹** Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¸ production
3. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ Ð»Ð¾Ð³Ð¸** - Ð¾Ð½Ð¸ Ð¿Ð¾ÐºÐ°Ð¶ÑƒÑ‚, ÐºÐ°ÐºÐ¾Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ
4. **Ð”Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ** Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ñ‚Ð¾ÐºÐµÐ½ Ð¾Ñ‚ @BotFather

## ðŸš€ Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!

Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ v4.0 Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð±ÐµÐ· PostgreSQL. ÐŸÑ€Ð¾ÑÑ‚Ð¾ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ `DEV_MODE=1` Ð¸ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð±Ð¾Ñ‚Ð°!

