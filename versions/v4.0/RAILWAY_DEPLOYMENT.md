# üöÇ Railway Deployment Guide –¥–ª—è v4.0

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Railway

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

1. **BOT_TOKEN** - –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
   - –ü–æ–ª—É—á–∏—Ç—å: @BotFather –≤ Telegram
   - –§–æ—Ä–º–∞—Ç: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`

2. **DATABASE_URL** - URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
   - Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —ç—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ PostgreSQL
   - –§–æ—Ä–º–∞—Ç: `postgresql://user:password@host:port/dbname`
   - –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ `postgresql+asyncpg://...` –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç `sslmode=require`

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

- **DEV_MODE** - –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0`)
  - `0` - Production —Ä–µ–∂–∏–º (—Ç—Ä–µ–±—É–µ—Ç DATABASE_URL)
  - `1` - Development —Ä–µ–∂–∏–º (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite, –µ—Å–ª–∏ DATABASE_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

- **DB_POOL_SIZE** - –†–∞–∑–º–µ—Ä –ø—É–ª–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `5`)
  - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 3-5 –¥–ª—è Railway

- **DB_MAX_OVERFLOW** - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0`)
  - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: `0` –¥–ª—è Railway

- **WRITE_PID_FILE** - –°–æ–∑–¥–∞–Ω–∏–µ PID —Ñ–∞–π–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0`)
  - `0` - –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è Railway)
  - `1` - –°–æ–∑–¥–∞–≤–∞—Ç—å –≤ `/tmp/bot.pid`

- **PORT** - –ü–æ—Ä—Ç –¥–ª—è health check —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `8080`)
  - Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `PORT`

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Railway Dashboard

1. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç** –≤ Railway
2. **–î–æ–±–∞–≤—å—Ç–µ PostgreSQL** —Å–µ—Ä–≤–∏—Å (Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç DATABASE_URL)
3. **–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - `BOT_TOKEN` - –≤–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
   - `DATABASE_URL` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è Railway –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ PostgreSQL
   - `DB_POOL_SIZE=5` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - `DB_MAX_OVERFLOW=0` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - `WRITE_PID_FILE=0` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–∞–ø—É—Å–∫:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Procfile` (—É–∂–µ —Å–æ–∑–¥–∞–Ω)
   - –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞: `python bot.py`

## –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞

### –î–ª—è Worker (Long Polling):
```
worker: python bot.py
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –≤ Railway Dashboard
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check:**
   - Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ—Ä—Ç –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `PORT`
   - Health check endpoint: `http://your-app.railway.app:PORT/health`

## –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞:
```bash
cd versions/v4.0
python3 -m py_compile database/database.py bot.py services/database_service.py
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤:
```bash
cd versions/v4.0
python3 -c "from database import init_db, get_session; print('OK')"
```

### 3. –¢–µ—Å—Ç —Å –ª–æ–∫–∞–ª—å–Ω—ã–º PostgreSQL:
```bash
cd versions/v4.0
export DATABASE_URL="postgresql://user:password@localhost:5432/spin_bot"
export BOT_TOKEN="your_token"
python3 bot.py
```

### 4. –¢–µ—Å—Ç —Å SQLite (development):
```bash
cd versions/v4.0
export DEV_MODE=1
export BOT_TOKEN="your_token"
python3 bot.py
```

## Troubleshooting

### –û—à–∏–±–∫–∞: "DATABASE_URL is not set"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL —Å–µ—Ä–≤–∏—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ Railway
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DATABASE_URL` –≤–∏–¥–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞

### –û—à–∏–±–∫–∞: "Connection refused"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `sslmode=require` –¥–æ–±–∞–≤–ª–µ–Ω (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### –û—à–∏–±–∫–∞: "Pool size exceeded"
- –£–º–µ–Ω—å—à–∏—Ç–µ `DB_POOL_SIZE` –¥–æ 3
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `DB_MAX_OVERFLOW=0`

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Railway Dashboard
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `BOT_TOKEN` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω (Worker –ø—Ä–æ—Ü–µ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω)

