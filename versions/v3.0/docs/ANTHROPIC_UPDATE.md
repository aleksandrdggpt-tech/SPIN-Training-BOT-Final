# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Anthropic API

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Anthropic Claude API –∫–∞–∫ fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞

### ‚úÖ –°—Ç–∞—Ç—É—Å Anthropic API:
```
Status: 200
‚úÖ Anthropic API —Ä–∞–±–æ—Ç–∞–µ—Ç!
Response: Hi! How can I help you today?
```

## –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### üîß –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã:
- **RESPONSE_PROVIDER**: `openai` ‚Üí `anthropic`
- **FEEDBACK_PROVIDER**: `openai` ‚Üí `anthropic`
- **CLASSIFICATION_PROVIDER**: `openai` ‚Üí `openai`

### ü§ñ –ú–æ–¥–µ–ª–∏:
- **RESPONSE_MODELS**: `gpt-4o-mini` ‚Üí `claude-3-haiku-latest`
- **FEEDBACK_MODELS**: `gpt-5-mini` ‚Üí `claude-3-5-sonnet-latest`
- **CLASSIFICATION_MODELS**: `gpt-4o-mini` ‚Üí `gpt-4o-mini`

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã OpenAI API
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `max_completion_tokens` –¥–ª—è –º–æ–¥–µ–ª–∏ `gpt-4o-mini`
- –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `max_tokens` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- –í–∫–ª—é—á–µ–Ω Anthropic –∫–∞–∫ fallback –¥–ª—è response –∏ feedback
- –°–æ—Ö—Ä–∞–Ω–µ–Ω OpenAI –∫–∞–∫ primary –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ OpenAI

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### üöÄ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:
- **–î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞** - –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ OpenAI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Anthropic
- **–í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –æ–¥–Ω–∏–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
- **–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –º–æ–¥–µ–ª–µ–π** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª—É—á—à–∏–µ –º–æ–¥–µ–ª–∏ –æ—Ç –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### üí∞ –≠–∫–æ–Ω–æ–º–∏—è:
- **Claude Haiku** –¥–ª—è response - –±—ã—Å—Ç—Ä–∞—è –∏ –¥–µ—à–µ–≤–∞—è –º–æ–¥–µ–ª—å
- **Claude Sonnet** –¥–ª—è feedback - –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á
- **GPT-4o-mini** –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ - –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á

### üéØ –ö–∞—á–µ—Å—Ç–≤–æ:
- **Claude 3.5 Sonnet** - –æ–¥–Ω–∞ –∏–∑ –ª—É—á—à–∏—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- **Claude 3 Haiku** - –±—ã—Å—Ç—Ä–∞—è –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
- **GPT-4o-mini** - –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
1. **Primary OpenAI —Ä–∞–±–æ—Ç–∞–µ—Ç** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è OpenAI
2. **Primary OpenAI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Anthropic
3. **–û–±–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞—é—Ç** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è primary (OpenAI)
4. **–û–±–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

### üß™ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
cd "/Users/aleksandrdg/Projects/SPIN Training BOT Final"
source venv/bin/activate
python3 bot.py

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
python3 -c "
import asyncio
from services.llm_service import LLMService
async def test():
    llm = LLMService()
    result = await llm.call_llm('feedback', '–¢—ã –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫', '–¢–µ—Å—Ç')
    print(result)
asyncio.run(test())
"
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### üìä –õ–æ–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- `LLM primary:` - —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ primary –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É
- `Primary failed:` - –æ—à–∏–±–∫–∏ primary –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- `LLM fallback:` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ fallback
- `Fallback failed:` - –æ—à–∏–±–∫–∏ fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### üîç –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç—ã:
- **OpenAI —Ä–∞–±–æ—Ç–∞–µ—Ç**: `OpenAI Chat payload: keys=...`
- **Anthropic —Ä–∞–±–æ—Ç–∞–µ—Ç**: `HTTP Request: POST https://api.anthropic.com/v1/messages`
- **Fallback –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω**: `LLM fallback: feedback provider=anthropic`

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ API –∫–ª—é—á–µ–π** - —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–∏–º–∏—Ç–∞–º–∏ –∏ –±–∞–ª–∞–Ω—Å–æ–º
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —á–∞—Å—Ç–æ—Ç—É fallback –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–±–æ—Ç—É –æ–±–æ–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
1. **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ API –∫–ª—é—á–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
2. **–û—Ç–ª–∞–¥–∫–∞ fallback** - –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–π—Ç–µ primary –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è fallback
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - —Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

## –°—Ç–∞—Ç—É—Å

**‚úÖ –ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ï–ù–£**

- Anthropic API –∫–ª—é—á —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- –í—Å–µ –º–æ–¥–µ–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
