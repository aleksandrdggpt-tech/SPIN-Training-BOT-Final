#!/bin/bash

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞ SPIN Training
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ SPIN Training Bot..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ PID —Ñ–∞–π–ª–∞
if [ -f "bot.pid" ]; then
    BOT_PID=$(cat bot.pid)
    echo "üìã –ù–∞–π–¥–µ–Ω PID —Ñ–∞–π–ª —Å PID: $BOT_PID"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å
    if ps -p $BOT_PID > /dev/null 2>&1; then
        echo "üîÑ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å..."
        kill $BOT_PID
        
        # –ñ–¥–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
        sleep 3
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å
        if ps -p $BOT_PID > /dev/null 2>&1; then
            echo "‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
            kill -9 $BOT_PID
            sleep 1
        fi
        
        # –£–¥–∞–ª—è–µ–º PID —Ñ–∞–π–ª
        rm -f bot.pid
        echo "‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
        echo "‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å —Å PID $BOT_PID –Ω–µ –Ω–∞–π–¥–µ–Ω, —É–¥–∞–ª—è–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏–π PID —Ñ–∞–π–ª"
        rm -f bot.pid
    fi
else
    echo "üìã PID —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å –ø–æ –∏–º–µ–Ω–∏..."
    
    # –ü–æ–∏—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –±–æ—Ç–∞ –ø–æ –∏–º–µ–Ω–∏
    BOT_PID=$(ps aux | grep "python.*bot.py" | grep -v grep | awk '{print $2}')
    
    if [ -z "$BOT_PID" ]; then
        echo "‚ùå –ü—Ä–æ—Ü–µ—Å—Å –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω"
        exit 1
    fi
    
    echo "üìã –ù–∞–π–¥–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å –±–æ—Ç–∞ —Å PID: $BOT_PID"
    
    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
    kill $BOT_PID
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
    sleep 2
    if ps -p $BOT_PID > /dev/null 2>&1; then
        echo "‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
        kill -9 $BOT_PID
    fi
    
    echo "‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi
