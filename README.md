# SPIN TRAINING BOT v.3.0 ‚Äî –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ–±—É—á–∞—é—â–∏—Ö –±–æ—Ç–æ–≤

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –æ–±—É—á–∞—é—â–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤. –õ–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ ‚Äî —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ –æ–±—É—á–∞—é—â–∏–µ –±–æ—Ç—ã –±–µ–∑ –ø—Ä–∞–≤–æ–∫ –∫–æ–¥–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
engine/
  scenario_loader.py     # –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤
  question_analyzer.py   # –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –≤–æ–ø—Ä–æ—Å–∞ –∏ –æ—á–∫–æ–≤ —è—Å–Ω–æ—Å—Ç–∏
  report_generator.py    # —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç, –±–µ–π–¥–∂–∏, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
services/
  llm_service.py         # OpenAI/Anthropic + fallback, HTTP/2, pooling
  training_service.py    # —Å–µ—Å—Å–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, —Ñ–∏–¥–±–µ–∫, TTL‚Äë–∫—ç—à
  user_service.py        # –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
infrastructure/
  health_server.py       # health‚Äëcheck HTTP
scenarios/
  spin_sales/            # –ø—Ä–æ–¥–∞–∫—à–Ω‚Äë—Å—Ü–µ–Ω–∞—Ä–∏–π SPIN
  template/              # —à–∞–±–ª–æ–Ω
bot.py                   # —Ö–µ–Ω–¥–ª–µ—Ä—ã Telegram –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è
```

## –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ v3.0 (–∫—Ä–∞—Ç–∫–æ)
- –ï–¥–∏–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã: httpx AsyncClient (HTTP/2, pooling) + AsyncOpenAI
- –ê–Ω—Ç–∏–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ ¬´–î–ê¬ª, TTL‚Äë–∫—ç—à —Ñ–∏–¥–±–µ–∫–∞, –ø—Ä–æ–≥—Ä–µ–≤ –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –°—Ç—Ä–∏–º–∏–Ω–≥ —Ñ–∏–¥–±–µ–∫–∞ –¥–ª—è GPT‚Äë4‚Äë—Å–µ—Ä–∏–∏ –∏ Anthropic (GPT‚Äë5 ‚Äî –æ–±—ã—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
- –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã: `/caseinfo`, `/author`; `/validate` ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- .env —É–ø—Ä–æ—â–µ–Ω–∞ ‚Äî —Ç–æ–ª—å–∫–æ —Å–µ–∫—Ä–µ—Ç—ã; –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ –∫–æ–¥–µ

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ venv):
```bash
pip install -r REQUIREMENTS.txt
```

2) –°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å `.env` (—Ç–æ–ª—å–∫–æ —Å–µ–∫—Ä–µ—Ç—ã –∏ –∞–¥–º–∏–Ω—ã):
```
BOT_TOKEN=...                # —Ç–æ–∫–µ–Ω Telegram‚Äë–±–æ—Ç–∞
OPENAI_API_KEY=...           # –∫–ª—é—á OpenAI
# (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Anthropic –¥–ª—è fallback
ANTHROPIC_API_KEY=...
# (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–ø–∏—Å–æ–∫ Telegram‚ÄëID –∞–¥–º–∏–Ω–æ–≤ –¥–ª—è /validate
ADMIN_USER_IDS=123456789,987654321
```

3) –ó–∞–ø—É—Å–∫:
```bash
python3 bot.py
```

–ö–æ–º–∞–Ω–¥—ã –≤ —á–∞—Ç–µ:
- `/start`, `/help`, `/stats`, `/rank`, `/caseinfo`, `/author`
- —Ç–µ–∫—Å—Ç–æ–≤—ã–µ: ¬´–Ω–∞—á–∞—Ç—å¬ª, ¬´–∑–∞–≤–µ—Ä—à–∏—Ç—å¬ª, ¬´–î–ê¬ª
- `/validate` ‚Äî –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω `ADMIN_USER_IDS`)

## –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

1) –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `scenarios/template` –≤ –Ω–æ–≤—É—é –ø–∞–ø–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä `scenarios/my_course`.

2) –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `scenarios/my_course/config.json`:
- `scenario_info`: –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏—è
- `messages`: —Ç–µ–∫—Å—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- `prompts`: —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–µ–π—Å–∞, –æ—Ç–≤–µ—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞, –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å)
- `question_types`: —Ç–∏–ø—ã –≤–æ–ø—Ä–æ—Å–æ–≤/—Ö–æ–¥–æ–≤ (–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, –æ—á–∫–∏ —è—Å–Ω–æ—Å—Ç–∏, –º–Ω–æ–∂–∏—Ç–µ–ª–∏)
- `game_rules`: –ø—Ä–∞–≤–∏–ª–∞ —Å–µ—Å—Å–∏–∏ (–º–∞–∫—Å–∏–º—É–º –≤–æ–ø—Ä–æ—Å–æ–≤, —Ü–µ–ª—å —è—Å–Ω–æ—Å—Ç–∏ –∏ —Ç.–ø.)
- `scoring`: –±–µ–π–¥–∂–∏ –ø–æ —à–∫–∞–ª–µ –æ—á–∫–æ–≤
- `ui`: —Ñ–æ—Ä–º–∞—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, –Ω–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥

3) –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –Ω–æ–≤–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é –≤ –∫–æ–¥–µ/–∫–æ–Ω—Ñ–∏–≥–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `scenarios/spin_sales/config.json`).

4) –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ config.json (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏)

```json
{
  "scenario_info": { "name": "...", "version": "1.0", "description": "..." },
  "messages": { "welcome": "...", "case_generated": "{client_case}", "training_complete": "{report}", "error_generic": "...", "progress": "...", "question_feedback": "...", "clarity_reached": "..." },
  "prompts": { "case_generation": "...", "client_response": "...", "feedback": "..." },
  "question_types": [ { "id": "...", "name": "...", "emoji": "", "keywords": ["..."], "clarity_points": 0, "score_multiplier": 0 } ],
  "game_rules": { "max_questions": 10, "min_questions_for_completion": 5, "target_clarity": 80, "short_question_threshold": 5 },
  "scoring": { "badges": [ { "min_score": 0, "max_score": 100, "name": "...", "emoji": "ü•â" } ] },
  "ui": { "progress_format": "...", "commands": ["–Ω–∞—á–∞—Ç—å", "—Å—Ç–∞—Ä—Ç", "–∑–∞–≤–µ—Ä—à–∏—Ç—å"] }
}
```

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –í—Å—è –ø—Ä–µ–¥–º–µ—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ `scenarios/.../config.json`.
- Health‚Äëcheck –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –ø–æ—Ä—Ç—É (—Å–º. –≤—ã–≤–æ–¥ –∑–∞–ø—É—Å–∫–∞).
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª–∏.

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –î–ª—è —Å–º–µ–Ω—ã –¥–æ–º–µ–Ω–∞ –æ–±—É—á–µ–Ω–∏—è –ø—Ä–∞–≤—å—Ç–µ —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥ —Å—Ü–µ–Ω–∞—Ä–∏—è ‚Äî –∫–æ–¥ –±–æ—Ç–∞ –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å `venv/`, `__pycache__/`, `logs/`, `.env` –≤–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (—Å–º. `.gitignore`).

