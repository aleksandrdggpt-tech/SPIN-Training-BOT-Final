SPIN Training BOT v4.0 â€” Project Structure
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ROOT/
â”‚
â”œâ”€â”€ ğŸ“ modules/                          [PAYMENT MODULE - PORTABLE]
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ ğŸ“ payments/
â”‚       â”œâ”€â”€ __init__.py                  # Module exports
â”‚       â”œâ”€â”€ config.py                    # Tariffs & settings
â”‚       â”œâ”€â”€ messages.py                  # Sales funnel texts
â”‚       â”œâ”€â”€ keyboards.py                 # Telegram keyboards
â”‚       â”œâ”€â”€ states.py                    # FSM states
â”‚       â”œâ”€â”€ subscription.py              # Subscription logic + decorator
â”‚       â”œâ”€â”€ promocodes.py                # Promocode system
â”‚       â”œâ”€â”€ handlers.py                  # Telegram handlers
â”‚       â””â”€â”€ ğŸ“ providers/
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ base.py                  # PaymentProvider base class
â”‚           â”œâ”€â”€ yookassa.py              # YooKassa provider
â”‚           â”œâ”€â”€ cloudpayments.py         # CloudPayments provider
â”‚           â””â”€â”€ prodamus.py              # Prodamus provider
â”‚
â”œâ”€â”€ ğŸ“ database/                         [DATABASE MODULE]
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ models.py                        # SQLAlchemy models (6 models)
â”‚   â”‚   â”œâ”€â”€ User
â”‚   â”‚   â”œâ”€â”€ Subscription
â”‚   â”‚   â”œâ”€â”€ Payment
â”‚   â”‚   â”œâ”€â”€ Promocode
â”‚   â”‚   â”œâ”€â”€ PromocodeUsage
â”‚   â”‚   â””â”€â”€ FreeTraining
â”‚   â””â”€â”€ database.py                      # Async connection & sessions
â”‚
â”œâ”€â”€ ğŸ“ services/                         [EXISTING v3 SERVICES]
â”‚   â”œâ”€â”€ user_service.py                  # User data (in-memory)
â”‚   â”œâ”€â”€ llm_service.py                   # OpenAI/Anthropic
â”‚   â”œâ”€â”€ training_service.py              # Training coordination
â”‚   â””â”€â”€ achievement_service.py           # Achievements
â”‚
â”œâ”€â”€ ğŸ“ engine/                           [EXISTING v3 ENGINE]
â”‚   â”œâ”€â”€ scenario_loader.py               # Scenario loading
â”‚   â”œâ”€â”€ question_analyzer.py             # Question classification
â”‚   â”œâ”€â”€ report_generator.py              # Report generation
â”‚   â””â”€â”€ case_generator.py                # Case generation
â”‚
â”œâ”€â”€ ğŸ“ infrastructure/                   [EXISTING v3 INFRASTRUCTURE]
â”‚   â””â”€â”€ health_server.py                 # Health check HTTP server
â”‚
â”œâ”€â”€ ğŸ“ scenarios/                        [EXISTING v3 SCENARIOS]
â”‚   â”œâ”€â”€ spin_sales/
â”‚   â”‚   â””â”€â”€ config.json
â”‚   â”œâ”€â”€ example_scenario/
â”‚   â””â”€â”€ template/
â”‚
â”œâ”€â”€ ğŸ“„ bot.py                            [MAIN BOT FILE - v3]
â”œâ”€â”€ ğŸ“„ config.py                         [APP CONFIGURATION - v3]
â”‚
â”œâ”€â”€ ğŸ“„ REQUIREMENTS_v4.txt               [V4 DEPENDENCIES]
â”œâ”€â”€ ğŸ“„ .env.v4.example                   [V4 ENV TEMPLATE]
â”‚
â”œâ”€â”€ ğŸ“– README_v4.md                      [V4 FULL DOCUMENTATION]
â”œâ”€â”€ ğŸ“– V4_INTEGRATION_GUIDE.md           [V4 INTEGRATION GUIDE]
â”œâ”€â”€ ğŸ“– V4_SUMMARY.md                     [V4 SUMMARY]
â””â”€â”€ ğŸ“– PROJECT_STRUCTURE_v4.txt          [THIS FILE]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”‘ KEY COMPONENTS:

modules/payments/
  â†’ Fully portable payment module
  â†’ Can be copied to any Telegram bot
  â†’ No dependencies on SPIN Bot specific code

database/
  â†’ SQLAlchemy 2.0 with async support
  â†’ 6 models: User, Subscription, Payment, Promocode, etc.
  â†’ SQLite by default, PostgreSQL for production

Payment Providers:
  â†’ base.py: Abstract base class
  â†’ 3 providers: YooKassa, CloudPayments, Prodamus
  â†’ Stub implementations (API calls to be implemented)

Subscription Logic:
  â†’ @subscription_required decorator
  â†’ Supports time-based (month/year) and credits-based
  â†’ Automatic access checking
  â†’ Integration with free trainings & promocodes

Promocode System:
  â†’ 3 types: trainings, free_month, credits
  â†’ Usage limits (per code & per user)
  â†’ Expiration dates
  â†’ Admin creation API

Sales Funnel:
  â†’ 8-stage conversion funnel
  â†’ Optimized texts based on Random Coffee People
  â†’ Social proof + money-back guarantee

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š STATISTICS:

  Files Created:        21
  Lines of Code:        ~3000+
  Database Models:      6
  Payment Providers:    3
  Tariff Plans:         6
  Promocode Types:      3
  Telegram Commands:    3
  Callback Handlers:    10+

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ INTEGRATION POINTS:

bot.py (main file):
  1. Import: from database import init_db, close_db
  2. Import: from modules.payments.handlers import register_payment_handlers
  3. Import: from modules.payments import subscription_required
  4. Initialize: await init_db()
  5. Register: register_payment_handlers(application)
  6. Protect: @subscription_required on training functions
  7. Cleanup: await close_db()

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… READY FOR:
  â†’ Local testing with promocodes
  â†’ Integration into existing bot.py
  â†’ Copying to other Telegram bots
  â³ Payment provider API implementation (requires API keys)
  â³ Production deployment

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
